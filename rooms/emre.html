<!DOCTYPE html>
<html lang="en">
<head>

  <meta charset="utf-8">
  <title>LIBERIWORLDapp</title>
  <meta name="description" content="">
  <meta name="author" content="Emre Can Eskimez">

  <!-- Mobile Specific Metas
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- FONT
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link href="//fonts.googleapis.com/css?family=Raleway:400,300,600" rel="stylesheet" type="text/css">
    

  <!--Animation.css-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.7.0/animate.min.css">
<link rel="stylesheet" href="css/master.css">
<link rel="stylesheet" href="css/skeleton.css">
<link rel="stylesheet" href="css/normalize.css">
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
<script src="/socket.io/socket.io.js"></script>
<link rel="stylesheet" href="css/tingle.css">
<script src="js/tingle.js"></script>

<script src="/js/fiddle.js"></script>

</head>

<html>
<body>
    
    


  
  </div>
  <nav class="container u-full-width">

      <!-- Kırmızı isim
      <div class="redbuble u-pull-right hidden300">
          <img src="images/name.png"  class="u-pull-left animated jello  name" >
          Name of the Room
      </div>
  -->
      <div class="mobile-menu u-full-width">
  
          <img src="images/name.png" id="myBtn"  class="js-tingle-modal-3 u-pull-right animated jello red mobile-icon" >
          <img src="images/hour.png"  class="u-pull-right animated jello yellow mobile-icon" >
      </div>
  
  
  
         <!--logo-->
    <img src="images/spy.png" class="logo " alt="">
    <h4 ><span id="roomname">/</span> </h4>
  
    
  
   
  </nav>



<div id="chat" class="main-chat">




</div>

<!--
<div class="container ">
    <img src="images/grayplane.png"  class="u-pull-left  grayplane" >
  <div class="row graybuble">
 
  <p>12345678901234567890</p>
</div>
</div>
 
   
 
-->

 





 
   

   <!--footer-->
    <footer class="chatbox" >

      <form class="" id="messageForm">
    
      <div class="container   text-area ">
         
          
        <textarea class="u-full-width adjust"  id="message" placeholder="Enter your message here!" type="text"  style="box-shadow: 0px 4px 4px rgba(0, 0, 0, 0.25);width:100%;height:1%!important;background-color:black;border:0;color:white;outline: none;opacity: 0.7;border-radius: 25px;"></textarea>
       
        <button value="Send Message" id="input_img" style="box-shadow: 0px 4px 4px rgba(0, 0, 0, 0.25);background: #1eff87;border: none;border-radius: 100px;" alt=""> <img src="images/lineplane.png" class="lineplane u-pull-right "  alt=""> </button>
        
      </div>
      
      
    </form>
    </footer>
   <!--/footer-->





  
<!-- End Document
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->




<script>
  //first of all i have to pass the name of the room in order to connect the correct room


  function trimurl(x) {
  let dirname = "http://localhost:3000/"  //this will be replaced
  return x.replace(dirname,'');
}






$(function(){

var roomname=trimurl(document.URL);
var  socket =  io.connect(); //burda girişte bağlamayı halletiğin an tammadır 
socket.emit('join',roomname);
var  $messageForm = $('#messageForm');
var  $message = $('#message');
var  $chat = $('#chat');
var  $output = $('#output');
function HtmlEncode(s)
{
  var el = document.createElement("div");
  el.innerText = el.textContent = s;
  s = el.innerHTML;
  return s;
}


$('#roomname').append(HtmlEncode(roomname));  // burda eğer 7 karakterden uzunsa Liberi.World yazsın


$messageForm.submit(function(e){
  e.preventDefault();
  if($message.val() != '' && $message.val() != ' ' )  {
    
    //buraya xss tagları removelatacağım
  //serverdaki send message fonksiyonuna gidiyor
  socket.emit('send message', HtmlEncode($message.val()) );
  $message.val('');
}
else  
  console.log("You cant send an empty message");
  
});
 
socket.on('new message', function(data){
  
  $chat.append('<div class="container">'+ '<img src="images/blueplane.png"  class="u-pull-left animated jello  grayplane" >'+'<div class="row gray animated fadeIn">'+ '<p>' + data.msg + '</p>'  + '</div>'  +'</div>' ) ;
  $chat.append('<div class="container">'+ '<img src="images/blueplane.png"  class="u-pull-left animated jello  blueplane" >'+'<div class="row bluebuble animated fadeIn">'+ '<p>' + data.msg + '</p>'  + '</div>'  +'</div>' ) ;
 
});
});




</script>



</body>
</html>




 <!-- Scripts buraya gelicek burdan local encoding ve storage yapabilirim 
aynı zamanda socketlarda buraya gelicek-->